
在单细胞RNA测序数据分析中，可视化是解析细胞异质性、挖掘基因表达模式的关键环节。我们常用UMAP、t-SNE等降维图展示单个基因的表达（如Seurat的FeaturePlot），或通过分组颜色区分细胞类型（如DimPlot）。但当研究涉及**细胞功能协同调控、细胞状态过渡或多标志物联合鉴定**时，仅展示1-2个基因的表达就显得不够了——此时，同时在降维图上呈现3个基因的表达模式，能帮我们挖掘更复杂的生物学信息。

SeuratExtend包中的`FeaturePlot3`和`FeaturePlot3.grid`函数，正是为解决这一需求而生。它们通过RYB或RGB色彩混合系统，将3个基因的表达水平“编码”为细胞的颜色，让我们直观看到不同基因在单细胞层面的共表达关系。今天就带大家详细拆解这一工具的原理、应用场景和实操方法。
  
## 一、核心原理：用色彩混合“翻译”基因表达

`FeaturePlot3`的核心逻辑是**将3个基因的表达水平与3种基础色绑定，再通过色彩混合呈现联合表达模式**。它支持两种色彩系统，适用不同的可视化需求：

### 1. RGB色彩系统：亮色凸显高表达

- **基础逻辑**：以红（Red）、绿（Green）、蓝（Blue）为三原色，**黑色代表3个基因均低表达，亮色/白色代表3个基因均高表达**。

- **颜色混合规则**：

  - 仅红色基因高表达 → 细胞呈红色；

  - 红色+绿色基因高表达 → 细胞呈黄色；

  - 红色+绿色+蓝色基因均高表达 → 细胞呈白色；

  - 3个基因均低表达 → 细胞呈黑色。

- **适合场景**：需要突出“高表达细胞群”，比如寻找3个标志物共表达的功能细胞亚群。

  ![image.png](https://s2.loli.net/2025/08/26/2zw13VNKkYdUAne.png)
### 2. RYB色彩系统：深色凸显高表达

- **基础逻辑**：以红（Red）、黄（Yellow）、蓝（Blue）为三原色，**白色代表3个基因均低表达，深色/黑色代表3个基因均高表达**。

- **颜色混合规则**：

  - 仅黄色基因高表达 → 细胞呈黄色；

  - 黄色+蓝色基因高表达 → 细胞呈绿色；

  - 红+黄+蓝基因均高表达 → 细胞呈黑色；

  - 3个基因均低表达 → 细胞呈白色。

- **适合场景**：避免高表达细胞与白色背景融合（如低表达细胞较多的数据集），更清晰区分“低表达背景”和“高表达目标群”。
![](https://s2.loli.net/2025/08/26/2zw13VNKkYdUAne.png)
  
## 二、关键应用场景：什么时候需要3基因联合展示？

并非所有分析都需要同时展示3个基因，以下3类场景是`FeaturePlot3`的“主战场”，能帮你解决传统可视化难以突破的问题：

### 1. 细胞类型精准鉴定：排除“假阳性”细胞

很多细胞类型的标志物并非“专属”——比如CD14（单核细胞标志物）可能在部分树突状细胞（DC）中低表达，仅用CD14+CD3-（排除T细胞）可能误判细胞类型。此时加入第3个标志物（如DC特异性的FCER1A），能更精准定义细胞群：

- 示例：用`FeaturePlot3(pbmc, color = "ryb", feature.1 = "CD3D", feature.2 = "CD14", feature.3 = "CD79A")`

  - 红色（CD3D+）→ T细胞；

  - 黄色（CD14+）→ 单核细胞；

  - 蓝色（CD79A+）→ B细胞；

  - 无明显颜色（三色均低）→ 可能是DC或NK细胞（需结合其他分析）；

  - 混合色（如红+黄）→ 排除，可能是 doublet（双细胞）或污染。

### 2. 细胞状态过渡分析：捕捉“中间态”细胞

细胞在分化、激活等过程中会经历“中间态”，此时多个基因的表达会逐渐变化（而非“非此即彼”）。比如T细胞从“ naive 状态”向“记忆状态”过渡时，CCR7（naive标志物）逐渐下调，CD45RO（记忆标志物）逐渐上调，同时可能伴随IL7R（存活相关）的波动——用3基因联合展示，能直观看到过渡细胞的分布：

- 红色（CCR7+）→ naive T细胞；

- 绿色（CD45RO+）→ 记忆T细胞；

- 黄色（CCR7+CD45RO+）→ 中间态T细胞；

- 蓝色（IL7R+）→ 高存活能力的细胞群；

- 黄+蓝混合色 → 中间态且高存活的T细胞（可能是关键功能群）。

### 3. 功能通路协同分析：验证基因共调控

在研究某一功能通路（如炎症反应、细胞凋亡）时，常需要验证通路内多个基因是否在同一细胞群中协同表达。比如研究单核细胞的炎症激活，可同时展示TLR4（炎症受体）、IL6（炎症因子）、TNFα（下游效应分子）：

- 红色（TLR4+）→ 受体表达细胞；

- 绿色（IL6+）→ 因子分泌细胞；

- 蓝色（TNFα+）→ 效应分子表达细胞；

- 黑色（三色均高，RYB系统）→ 完全激活的炎症单核细胞；

- 仅红色/绿色 → 部分激活的细胞（可能处于激活早期/晚期）。

## 三、实操教程：3步画出3基因联合降维图

下面以PBMC（外周血单核细胞）数据集为例，带大家用SeuratExtend实现3基因可视化，从基础到批量分析全覆盖。

### 前置准备：加载数据和包

首先确保已安装Seurat和SeuratExtend，并加载之前注释好的PBMC对象（若未准备，可参考Seurat官方PBMC教程）：

```r
# 1. 加载包
library(Seurat)
library(SeuratExtend)

# 2. 加载注释好的PBMC对象（Lesson 2输出结果）
pbmc <- readRDS("rds/pbmc_annotated.rds")
```

### 1. 基础版：单个3基因组合可视化

以“T细胞（CD3D）、单核细胞（CD14）、B细胞（CD79A）”三群标志物为例，分别用RYB和RGB系统展示：

```r
# RYB系统（深色凸显高表达，适合区分低表达背景）
FeaturePlot3(
  pbmc,
  color = "ryb",  # 选择色彩系统
  feature.1 = "CD3D",  # 红色：T细胞标志物
  feature.2 = "CD14",  # 黄色：单核细胞标志物
  feature.3 = "CD79A", # 蓝色：B细胞标志物
  pt.size = 0.5  # 点大小（RYB建议小一点，避免重叠）
)

# RGB系统（亮色凸显高表达，适合突出高表达群）
FeaturePlot3(
  pbmc,
  color = "rgb",
  feature.1 = "CD3D",
  feature.2 = "CD14",
  feature.3 = "CD79A",
  pt.size = 1  # RGB建议大一点，避免高表达细胞与背景融合
)
```

![image.png](https://s2.loli.net/2025/08/26/VGxRceUHAjnFBJd.png)
![image.png](https://s2.loli.net/2025/08/26/pRgENB4MraHI5UY.png)

### 2. 进阶版：批量展示多个3基因组合

如果需要同时分析多组3基因组合（如不同细胞系的标志物、不同通路的基因），用`FeaturePlot3.grid`函数批量生成子图，效率更高。比如同时分析“免疫细胞标志物”和“单核细胞亚型标志物”：

```r
# 定义多组3基因组合（不足3个用NA占位）
features_list <- c(
  "CD3D", "CD14", "CD79A",  # 第一组：T/单核/B细胞
  "FCGR3A", NA, "LYZ"       # 第二组：单核细胞亚型（FCGR3A+为非经典单核，LYZ+为经典单核）
)

# 批量生成子图（RYB系统）
FeaturePlot3.grid(
  pbmc,
  features = features_list,  # 输入多组基因
  color = "ryb",
  pt.size = 0.5
)
```
![image.png](https://s2.loli.net/2025/08/26/8V1kQgKTFvPOqCX.png)

  ### 3. 优化技巧：让图更“ publication-ready ”

- **点大小调整**：RYB系统用`pt.size=0.3-0.5`（避免深色点重叠），RGB系统用`pt.size=0.8-1.2`（避免亮色点被背景覆盖）；
- **添加标签和主题**：结合`ggplot2`主题函数（如`NoAxes()`去除坐标轴，`theme_umap_arrows()`添加UMAP方向标）；
- **颜色微调**：若默认颜色不清晰，可通过`cols`参数自定义三原色（如`cols = c("red", "orange", "blue")`）。

## 四、常见问题与解决方案

1. **问题1：高表达细胞与背景融合？**  

   - 若用RGB系统，可能因高表达细胞呈浅色（如白色）与背景混淆，解决方案：调大`pt.size`（如1.2），或改用RYB系统（高表达呈深色）。

2. **问题2：3个基因均低表达，细胞颜色无区分？**  

   - 这是正常现象（RGB呈黑色、RYB呈白色），可通过`scale_clamp`参数限制表达范围（如`scale_clamp = c(0, 3)`），增强低表达区间的颜色差异。
  
3. **问题3：子图太多导致标签拥挤？**  

   - 用`ncol`或`nrow`参数调整子图排列（如`FeaturePlot3.grid(..., ncol = 2)`），或用`theme(axis.text = element_blank())`隐藏冗余标签。

## 总结

`FeaturePlot3`系列函数为单细胞可视化提供了“1+1+1>3”的分析维度——它不再局限于单个基因的表达或细胞类型的划分，而是通过色彩混合直观呈现基因间的共表达关系，尤其适合**细胞精准鉴定、状态过渡分析和功能通路验证**。掌握这一工具，能让你的单细胞分析从“描述细胞是什么”，升级为“解析细胞在做什么”，为后续的机制研究提供更精准的方向。

下一期我们将继续拆解SeuratExtend的其他高级可视化工具（如聚类分布条形图、增强型小提琴图），关注不迷路，一起解锁单细胞分析的“可视化密码”！