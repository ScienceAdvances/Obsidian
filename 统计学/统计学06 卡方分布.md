## 概念和思想

![](https://cdn.nlark.com/yuque/__latex/31e8b215db2ad0a073daf2fbd310fd00.svg)分布可以用来检验模型的适合性,变量的独立性等;

对象是类别变量; ![](https://cdn.nlark.com/yuque/__latex/db00ba7414933e0af3ce9df9ee3676b4.svg): Observaton 观案教据; ![](https://cdn.nlark.com/yuque/__latex/ef9672125f9f4457360a32db1e45a19d.svg): Expeutatiom 期望表据。

![](https://cdn.nlark.com/yuque/__latex/1d59c3dacc4a22585691b1ddc2e21825.svg)

思想：假设数据符合某一种分布，根据这种分布计算出数据应该有的样子（![](https://cdn.nlark.com/yuque/__latex/ef9672125f9f4457360a32db1e45a19d.svg)），再用现实中观察到的数据（![](https://cdn.nlark.com/yuque/__latex/db00ba7414933e0af3ce9df9ee3676b4.svg)）与之比较。如果两者相差过大，就拒绝原假设。

## 卡方检验 [Pearson chi-squared test](https://juliastats.org/HypothesisTests.jl/latest/parametric/#Pearson-chi-squared-test)

R语言中的例子，三个patry中性别分布有没有差异。

H0: 三个patry中性别分布没有差异，即等比例分布

HA: 三个patry中性别分布有差异

第1步，计算自由度

![](https://cdn.nlark.com/yuque/__latex/0c9607eca4dadb275642065bf8c1a9ca.svg)

第2步，观察数据Oi的列联表

|   |   |   |   |   |
|---|---|---|---|---|
|gender/patry|Democrat|Independent|Republican|Row Sum|
|Female|762|327|468|1557|
|Male|484|239|477|1200|
|Column Sum|1246|566|945|2757|

第3步，期望数据Ei的列联表

假设H0是正确的，那么现在计算出数据应该有的样子（根据男女等比例）

|   |   |   |   |   |
|---|---|---|---|---|
|gender/patry|Democrat|Independent|Republican|Row Sum|
|Female|703.6714|319.6453|533.6834|1557|
|Male|542.3286|246.3547|411.3166|1200|
|Column Sum|1246|566|945|2757|

第4步，计算![](https://cdn.nlark.com/yuque/__latex/06a88c61181eaebe2bd5f0f979e0af42.svg)值

|   |   |   |   |   |
|---|---|---|---|---|
|gender/patry|Democrat|Independent|Republican|Row Sum|
|Female|4.83497|0.169225|8.08401|8.08401|
|Male|6.27337|0.21957|10.489|1200|
|Column Sum|1246|566|945|30.070...|

对于每一行每一列计算对应位置的![](https://cdn.nlark.com/yuque/__latex/06a88c61181eaebe2bd5f0f979e0af42.svg)值

![](https://cdn.nlark.com/yuque/__latex/3db03fc859ba6015f603d96997aefcfa.svg)

```
function chi(matrix::AbstractMatrix)
  N=sum(matrix)
  E=Matrix{Float64}(undef,2,3)
  X=Matrix{Float64}(undef,2,3)
  for x in 1:size(matrix)[1] 
    for y in 1:size(matrix)[2]
      r=matrix[x,:]
      c=matrix[:,y]
      rsum=sum(r)
      csum=sum(c)
      o=matrix[x,y]
      e=rsum/N*csum
      E[x,y]=e
      X[x,y]=(e-o)^2/e
    end
  end
  return E,X
end

m=Matrix([762 327 468; 484 239 477])  
E,X=chi(m)
E
# 2×3 Matrix{Float64}:
# 703.671  319.645  533.683
# 542.329  246.355  411.317
X
# 2×3 Matrix{Float64}:
# 4.83497  0.169225   8.08401
# 6.27337  0.21957   10.489
```

第5步，查表

计算出卡方值之和后，通过查表可以得出p值。

```
using CairoMakie,Distributions
let
  f=Figure()
  Axis(f[1, 1])
  x = 0:0.1:35
  lines!(x, pdf.(Chisq(2), x), label = "df = 2")
  vlines!(30.07,ymax=0.05,color=:red)
  axislegend()
  current_figure()
end
```

![image.png](https://s2.loli.net/2025/09/08/JzI3HOSngKViR12.png)


## Julia中使用函数做卡方检验

```
using HypothesisTests
m=Matrix([762 327 468; 484 239 477])                  
ChisqTest(m)
# Pearson's Chi-square Test
# -------------------------
# Population details:
#     parameter of interest:   Multinomial Probabilities
#     value under h_0:         [0.255231, 0.19671, 0.11594, 0.0893561, 0.193574, 0.14919]
#     point estimate:          [0.276387, 0.175553, 0.118607, 0.0866884, 0.16975, 0.173014]
#     95% confidence interval: [(0.2545, 0.2994), (0.1573, 0.1955), (0.1033, 0.1358), (0.07357, 0.1019), (0.1517, 0.1894), (0.1548, 0.1928)]

# Test summary:
#     outcome with 95% confidence: reject h_0
#     one-sided p-value:           <1e-06

# Details:
#     Sample size:        2757
#     statistic:          30.070149095754687
#     degrees of freedom: 2
#     residuals:          [2.19886, -2.50467, 0.41137, -0.468583, -2.84324, 3.23867]
#     std. residuals:     [4.50205, -4.50205, 0.699452, -0.699452, -5.31595, 5.31595]
```

因为p<0.05，所以在置信度为5%情况下，拒绝H0接受H1，即三个patry中性别分布有差异。

## Reference

```
https://www.bilibili.com/video/BV1CA411P7bL
```