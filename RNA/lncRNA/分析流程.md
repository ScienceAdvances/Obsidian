![[Pasted image 20250804200515.png]]

## 1. hisat2把测序数据对比到参考基因组上得到bam文件

```shell
hisat2 -p 16 -x $hisat2_index/$SPECIES -1 Result/01.clean_data/${name}_1.fq.gz -2 Result/01.clean_data/${name}_2.fq.gz |
sambamba view --nthreads $THREADS --sam-input --format bam /dev/stdin --output-filename ${name}.bam
```

## 1. stringtie对已知转录本定量

```shell
stringtie -p $THREADS \
-e -G $GTF \
-o ${name}.gtf \
-A ${name}_gene_abundance.tsv \
-l ${name} \
align.bam
```

Assemble RNA-Seq alignments into potential transcripts
```shell
stringtie <in.bam ..> [-G <guide_gff>] [-l <prefix>] [-o <out.gtf>] [-p <cpus>]  [-v] [-a <min_anchor_len>] [-m <min_len>] [-j <min_anchor_cov>] [-f <min_iso>]  [-c <min_bundle_cov>] [-g <bdist>] [-u] [-L] [-e] [--viral] [-E <err_margin>]  [--ptf <f_tab>] [-x <seqid,..>] [-A <gene_abund.out>] [-h] {-B|-b <dir_path>} [--mix] [--conservative] [--rf] [--fr]

-G reference annotation to use for guiding the assembly process (GTF/GFF)
-o output path/file name for the assembled transcripts GTF (default: stdout)
-l name prefix for output transcripts (default: STRG)
-v verbose (log bundle processing details)
-p number of threads (CPUs) to use (default: 1)
-A gene abundance estimation output file
-E define window around possibly erroneous splice sites from long reads to look out for correct splice sites (default: 25)
-e only estimate the abundance of given reference transcripts (requires -G)
```
Transcript merge usage mode
 
```shell
 stringtie --merge [Options] { gtf_list | strg1.gtf ...}
 
-G <guide_gff>   reference annotation to include in the merging (GTF/GFF3)
-l <label>       name prefix for output transcripts (default: MSTRG)
-o <out_gtf>     output file name for the merged transcripts GTF(default: stdout)
```


```shell
stringtie --merge -p $THREADS \
-G $GTF -o stringtie_merge.gtf \
T3/hisat/T3.gtf T4/hisat/T4.gtf

gffcompare -r $GTF -o gffcompare stringtie_merge.gtf
```


gffcompare 输出文件*.annotated.gtf的 class_code 用于标记组装转录本与参考注释的关系
- `=`：与参考转录本完全匹配（外显子结构一致）
- `c`：潜在剪切变体（共享部分外显子，结构不同）
- `j`：新亚型（含新外显子，与参考基因重叠）
- `u`：未知转录本（不与任何参考基因重叠，可能是新基因）
- `x`：反义链转录本（与参考基因反向互补）
- `i`：内含子区域转录本（完全位于参考基因内含子中）
- `o`：外显子重叠但结构无关联
- `p`：多外显子部分匹配参考（非剪切变体）
- `r`：重复区域转录本
- `s`：单外显子部分匹配参考
- `e`：可能的错误组装（单外显子与参考内含子重叠）
**其中i，j，o，u，x这5类转录本表示可能是新的lncRNA转录本**

## 保留指定class_code的transcripts
![[Pasted image 20250804202441.png]]


```shell
mamba activate fastp

export -f run_fastp

mkdir -p Result/10.stat/fastp_report

print_sample | parallel -j 8 run_fastp
```